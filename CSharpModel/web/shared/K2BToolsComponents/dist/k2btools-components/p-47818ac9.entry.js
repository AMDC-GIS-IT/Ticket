import{r as t,c as e,h as n}from"./p-96e74049.js";import{C as s}from"./p-2aed5163.js";const o=class{constructor(n){t(this,n),this.changeEvent=e(this,"change",7),this.newRecordClickedEvent=e(this,"newRecordClicked",7),this.inputValueChangedEvent=e(this,"inputValueChanged",7),this.value=null,this.noresultsfoundtext="No results found",this.enableadditem=!0,this.additemcaption="New record",this.enabled=!0,this.readonlyclass="",this.searchvalue="",this.placeholder="",this.container=null,this.selectedElement=null}processKeydown(t){if(27==t.which&&(this.open=!1,t.stopPropagation()),13==t.which)return this.open=!this.open,this.searchvalue=this.getValueDescription(),t.stopPropagation(),!1;if(this.open)if(40==t.which){if(t.stopPropagation(),t.preventDefault(),(n=s.getAtomicValues_impl(this.getFilteredValues())).length>0){var e=n.findIndex(t=>t.value==this.value);this.setValueWithoutClosing(-1==e?n[0].value:n[e=((e+1)%n.length+n.length)%n.length].value)}}else if(38==t.which){var n;t.stopPropagation(),t.preventDefault(),(n=s.getAtomicValues_impl(this.getFilteredValues())).length>0&&(e=n.findIndex(t=>t.value==this.value),this.setValueWithoutClosing(-1==e?n[n.length-1].value:n[e=((e-1)%n.length+n.length)%n.length].value))}}closeMenu(t){this.container.contains(t.target)||(this.open=!1)}setValue(t){this.setValueWithoutClosing(t),this.searchvalue=this.getValueDescription(),this.open=!1}setValueWithoutClosing(t){this.value=t,this.changeEvent.emit(t)}getRawValues(){return null==this.values?[]:"string"==typeof this.values?""==this.values?[]:JSON.parse(this.values):[...this.values]}getFilteredValues(){if(!this.open)return[];var t=this.getRawValues();return""!=this.searchvalue&&(t=this.getFilteredValues_impl(t)),t}getFilteredValues_impl(t){var e=[];if(null!=t)for(let o of t)if(-1!=o.description.toLocaleLowerCase().indexOf(this.searchvalue.toLocaleLowerCase()))e=e.concat(o);else{var n=this.getFilteredValues_impl(o.items);if(n.length>0){var s=Object.assign({},o);s.items=n,e=e.concat(s)}}return e}onIncludeNewRecordClick(){this.open=!1,this.newRecordClickedEvent.emit(null)}getAtomicValues(){return s.getAtomicValues_impl(this.getRawValues())}getSuggestPopoverContent(){const t=this.getRawValues();var e=s.containsDetails(t),o=s.containsIcons(t),i=s.containsTrailingText(t);const h=this.getFilteredValues();return h.length>0?h.map(t=>this.getItemContent(t,e,o,i)):n("div",{class:"K2BTEnhancedComboNoItemsFound"},this.noresultsfoundtext)}onImageError(t){t.target.classList.add("K2BTEnhancedComboIconInvisible")}getItemContent(t,e,s,o){var i;return(null===(i=t.items)||void 0===i?void 0:i.length)>0?n("div",{class:"K2BTEnhancedComboCategory"},n("span",{class:"K2BTEnhancedComboCategoryName"},t.description),n("div",{class:"K2BTEnchancedComboCategoryContents"},t.items.map(t=>this.getItemContent(t,e,s,o)))):n("div",{class:this.value==t.value?"K2BTEnhancedComboItem K2BTEnhancedComboSelected":"K2BTEnhancedComboItem",ref:e=>{this.value==t.value&&(this.selectedElement=e)},onClick:()=>this.setValue(t.value)},s?n("div",{class:"K2BTEnhancedComboIconContainer"},n("img",{class:"K2BTEnhancedComboIcon",src:t.imageUrl,onError:t=>this.onImageError(t)})):"",n("div",{class:"K2BTEnhancedComboItem_TextColumn"},n("div",{class:"K2BTEnhancedComboItem_TextContainer"},n("span",{class:"K2BTEnhancedComboDescription"},this.getHighlightedText(t.description)),o?n("span",{class:"K2BTEnhancedComboTrailingText"},this.getHighlightedText(t.trailingText)):""),n("div",{class:"K2BTEnhancedComboItem_TextContainer"},e?n("span",{class:"K2BTEnhancedComboSubtitle"},this.getHighlightedText(t.detail)):"")))}getHighlightedText(t){var e=t.toLowerCase().indexOf(this.searchvalue.toLowerCase());return null==this.searchvalue||""==this.searchvalue||-1==e?n("span",null,t):n("span",null,t.substring(0,e),n("span",{class:"K2BTEnhancedComboSearchHighlight"},t.substring(e,e+this.searchvalue.length)),this.getHighlightedText(t.substring(e+this.searchvalue.length)))}changeSearchValue(t){this.searchvalue=t,this.inputValueChangedEvent.emit(null)}getValueDescription(){var t=this.getAtomicValues().find(t=>t.value==this.value);return null!=t?t.description:this.value}render(){return this.selectedElement=null,n("div",null,n("span",{class:this.readonlyclass,style:this.enabled?{display:"none"}:{}},this.getValueDescription()),n("div",{tabindex:"0",class:"K2BTEnhancedCombo",ref:t=>this.container=t,style:this.enabled?{}:{display:"none"}},n("input",{type:"text",class:"form-control Attribute_Trn K2BTEnhancedSuggestInput",value:this.searchvalue,onInput:t=>this.changeSearchValue(t.target.value),placeholder:this.placeholder,onClick:()=>this.open=!0}),n("div",{class:this.open?"K2BTEnhancedComboContentsOpen":"K2BTEnhancedComboContentsClosed"},n("div",{class:"K2BTEnhancedComboItems"},this.getSuggestPopoverContent()),this.enableadditem?n("span",{class:"K2BTEnhancedComboNewAction",onClick:()=>this.onIncludeNewRecordClick()},this.additemcaption):"")))}};o.style=":host{display:block}.K2BTEnhancedCombo{float:left}.K2BTEnhancedComboHeader{border-bottom:1px solid #ccc}.K2BTEnhancedComboHeader:after{content:'â–¼';width:0px}.K2BTEnhancedComboContentsOpen{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;position:absolute;border:1px solid #ccc;background-color:#fff;z-index:1}.K2BTEnhancedComboSearchInput{width:100%}.K2BTEnhancedComboItems{max-height:300px;overflow:auto;scrollbar-width:thin;scrollbar-color:#d7d7d7 transparent}.K2BTEnhancedComboItems::-webkit-scrollbar{width:6px}.K2BTEnhancedComboItems::-webkit-scrollbar-thumb{background-color:#d7d7d7;border:1px solid transparent;cursor:pointer}.K2BTEnhancedComboContentsClosed{display:none}.K2BTEnhancedComboItem{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-align:center;align-items:center;padding:8px}.K2BTEnhancedComboItem:hover{background-color:#ddd;cursor:pointer}.K2BTEnhancedComboItem_TextContainer{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-positive:1;flex-grow:1}.K2BTEnhancedComboSubtitle{font-size:12px}.K2BTEnhancedComboCategoryName{padding-left:5px}.K2BTEnchancedComboCategoryContents .K2BTEnhancedComboItem{padding-left:10px}.K2BTEnhancedComboIcon{width:30px;height:30px;-o-object-fit:cover;object-fit:cover;margin-right:4px}.K2BTEnhancedComboIconInvisible{visibility:hidden}.K2BTEnhancedComboNoItemsFound{width:100%;text-align:center;margin-top:40px;margin-bottom:40px}.K2BTEnhancedComboTrailingText{-ms-flex-positive:0;flex-grow:0}";export{o as k2bt_enhancedsuggest}