import{r as t,c as e,h as s}from"./p-96e74049.js";import{C as i}from"./p-2aed5163.js";const n=class{constructor(s){t(this,s),this.changeEvent=e(this,"change",7),this.searchChangedEvent=e(this,"searchChanged",7),this.newRecordClickedEvent=e(this,"newRecordClicked",7),this.value=null,this.includesearch=!0,this.includeemptyitem=!0,this.emptyitemtext="(none)",this.noresultsfoundtext="No results found",this.enableadditem=!0,this.additemcaption="New record",this.searchfieldplaceholder="Search",this.searchvalue="",this.enabled=!0,this.readonlyclass="",this.container=null,this.selectedElement=null,this.searchfield=null,this._keyboardSearchPrefix="",this._keyboardSearchLastKeystroke=null}processKeydown(t){if("Escape"==t.key)this.resetPrefixSearch(),this.open=!1,t.stopPropagation();else{if("Enter"==t.key)return this.resetPrefixSearch(),this.open=!this.open,t.stopPropagation(),!1;if("ArrowDown"==t.key){if(this.resetPrefixSearch(),t.stopPropagation(),t.preventDefault(),(o=i.getAtomicValues_impl(this.getFilteredValues())).length>0){var e=o.findIndex(t=>t.value.trim()==this.value.trim());this.setValueWithoutClosing(-1==e?o[0].value.trim():o[e=((e+1)%o.length+o.length)%o.length].value.trim())}}else if("ArrowUp"==t.key)this.resetPrefixSearch(),t.stopPropagation(),t.preventDefault(),(o=i.getAtomicValues_impl(this.getFilteredValues())).length>0&&(e=o.findIndex(t=>t.value.trim()==this.value.trim()),this.setValueWithoutClosing(-1==e?o[o.length-1].value.trim():o[e=((e-1)%o.length+o.length)%o.length].value.trim()));else{var s=t.key;if(1==s.length&&document.activeElement!=this.searchfield){var n=Date.now();(null==this._keyboardSearchLastKeystroke||n-this._keyboardSearchLastKeystroke>3e3)&&(this._keyboardSearchPrefix=""),this._keyboardSearchPrefix=this._keyboardSearchPrefix+s;var o,h=(o=i.getAtomicValues_impl(this.getFilteredValues())).find(t=>0==t.description.toLowerCase().indexOf(this._keyboardSearchPrefix.toLowerCase()));null!=h&&this.setValueWithoutClosing(h.value.trim()),this._keyboardSearchLastKeystroke=n}}}}onFocusIn(){this.resetPrefixSearch()}resetPrefixSearch(){this._keyboardSearchLastKeystroke=null}closeMenu(t){this.resetPrefixSearch(),this.container.contains(t.target)||(this.open=!1)}getHeaderContent(){if(null==this.value)return this.emptyitemtext;var t=this.getAtomicValues().filter(t=>t.value.trim()==this.value.trim());return t.length>0?t[0].description:this.emptyitemtext}toggleContentVisibilty(){this.resetPrefixSearch(),this.open=!this.open}getRawValues(){var t;return t=null==this.values?[]:"string"==typeof this.values?""==this.values?[]:JSON.parse(this.values):[...this.values],this.includeemptyitem&&t.unshift({value:"",description:this.emptyitemtext,imageUrl:"",detail:"",trailingText:"",items:[]}),t}getFilteredValues(){var t=this.getRawValues();return this.includesearch&&""!=this.searchvalue&&(t=this.getFilteredValues_impl(t)),t}getFilteredValues_impl(t){var e=[];if(null!=t)for(let n of t)if(-1!=n.description.toLocaleLowerCase().indexOf(this.searchvalue.toLocaleLowerCase())||-1!=n.detail.toLocaleLowerCase().indexOf(this.searchvalue.toLocaleLowerCase())||-1!=n.trailingText.toLocaleLowerCase().indexOf(this.searchvalue.toLocaleLowerCase()))e=e.concat(n);else{var s=this.getFilteredValues_impl(n.items);if(s.length>0){var i=Object.assign({},n);i.items=s,e=e.concat(i)}}return e}setValue(t){this.setValueWithoutClosing(t),this.open=!1}setValueWithoutClosing(t){this.value=t,this.changeEvent.emit(t)}changeSearchValue(t){this.searchvalue=t,this.searchChangedEvent.emit({value:t})}onIncludeNewRecordClick(){this.open=!1,this.newRecordClickedEvent.emit(null)}render(){return this.selectedElement=null,s("div",null,s("p",{class:"form-control-static",style:this.enabled?{display:"none"}:{}},s("span",{class:this.readonlyclass},this.getHeaderContent())),s("div",{tabindex:"0",class:"K2BTEnhancedCombo",ref:t=>this.container=t,style:this.enabled?{}:{display:"none"}},s("div",{class:"K2BTEnhancedComboHeader",onClick:()=>this.toggleContentVisibilty()},this.getHeaderContent()),s("div",{class:this.open?"K2BTEnhancedComboContentsOpen":"K2BTEnhancedComboContentsClosed"},this.includesearch?s("input",{type:"text",class:"K2BTEnhancedComboSearchInput",ref:t=>this.searchfield=t,onInput:t=>this.changeSearchValue(t.target.value),placeholder:this.searchfieldplaceholder}):"",s("div",{class:"K2BTEnhancedComboItems"},this.getComboContent()),this.enableadditem?s("span",{class:"K2BTEnhancedComboNewAction",onClick:()=>this.onIncludeNewRecordClick()},this.additemcaption):"")))}getAtomicValues(){return i.getAtomicValues_impl(this.getRawValues())}getComboContent(){const t=i.getAtomicValues_impl(this.getRawValues());var e=i.containsDetails(t),n=i.containsIcons(t),o=i.containsTrailingText(t);const h=this.open?this.getFilteredValues():[];return h.length>0?h.map(t=>this.getItemContent(t,e,n,o)):s("div",{class:"K2BTEnhancedComboNoItemsFound"},this.noresultsfoundtext)}onImageError(t){t.target.classList.add("K2BTEnhancedComboIconInvisible")}getItemContent(t,e,i,n){var o;return(null===(o=t.items)||void 0===o?void 0:o.length)>0?s("div",{class:"K2BTEnhancedComboCategory"},s("span",{class:"K2BTEnhancedComboCategoryName"},t.description),s("div",{class:"K2BTEnchancedComboCategoryContents"},t.items.map(t=>this.getItemContent(t,e,i,n)))):s("div",{class:this.value.trim()==t.value.trim()?"K2BTEnhancedComboItem K2BTEnhancedComboSelected":"K2BTEnhancedComboItem",ref:e=>{this.value.trim()==t.value.trim()&&(this.selectedElement=e)},onClick:()=>this.setValue(t.value.trim())},i?s("div",{class:"K2BTEnhancedComboIconContainer"},s("img",{class:"K2BTEnhancedComboIcon",src:t.imageUrl,onError:t=>this.onImageError(t)})):"",s("div",{class:"K2BTEnhancedComboItem_TextColumn"},s("div",{class:"K2BTEnhancedComboItem_TextContainer"},s("span",{class:"K2BTEnhancedComboDescription"},this.getHighlightedText(t.description)),n?s("span",{class:"K2BTEnhancedComboTrailingText"},this.getHighlightedText(t.trailingText)):""),s("div",{class:"K2BTEnhancedComboItem_TextContainer"},e?s("span",{class:"K2BTEnhancedComboSubtitle"},this.getHighlightedText(t.detail)):"")))}getHighlightedText(t){var e=t.toLowerCase().indexOf(this.searchvalue.toLowerCase());return null==this.searchvalue||""==this.searchvalue||-1==e?s("span",null,t):s("span",null,t.substring(0,e),s("span",{class:"K2BTEnhancedComboSearchHighlight"},t.substring(e,e+this.searchvalue.length)),this.getHighlightedText(t.substring(e+this.searchvalue.length)))}componentDidRender(){null!=this.selectedElement&&this.selectedElement.scrollIntoView({block:"nearest"})}componentDidLoad(){var t=this.getAtomicValues();this.includeemptyitem||0!=t.filter(t=>t.value.trim()==this.value.trim()).length||t.length>0&&this.setValueWithoutClosing(t[0].value.trim())}};n.style=":host{display:block}.K2BTEnhancedComboHeader{border-bottom:1px solid #ccc}.K2BTEnhancedComboHeader:after{content:'â–¼';width:0px}.K2BTEnhancedComboContentsOpen{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;position:absolute;border:1px solid #ccc;background-color:#fff;z-index:1}.K2BTEnhancedComboSearchInput{width:100%}.K2BTEnhancedComboItems{max-height:300px;overflow:auto;scrollbar-width:thin;scrollbar-color:#d7d7d7 transparent}.K2BTEnhancedComboItems::-webkit-scrollbar{width:6px}.K2BTEnhancedComboItems::-webkit-scrollbar-thumb{background-color:#d7d7d7;border:1px solid transparent;cursor:pointer}.K2BTEnhancedComboContentsClosed{display:none}.K2BTEnhancedComboItem{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-align:center;align-items:center;padding:8px}.K2BTEnhancedComboItem:hover{background-color:#ddd;cursor:pointer}.K2BTEnhancedComboItem_TextContainer{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-positive:1;flex-grow:1}.K2BTEnhancedComboSubtitle{font-size:12px}.K2BTEnhancedComboCategoryName{padding-left:5px}.K2BTEnchancedComboCategoryContents .K2BTEnhancedComboItem{padding-left:10px}.K2BTEnhancedComboIcon{width:30px;height:30px;-o-object-fit:cover;object-fit:cover;margin-right:4px}.K2BTEnhancedComboIconInvisible{visibility:hidden}.K2BTEnhancedComboNoItemsFound{width:100%;text-align:center;margin-top:40px;margin-bottom:40px}.K2BTEnhancedComboTrailingText{-ms-flex-positive:0;flex-grow:0}";export{n as k2bt_enhancedcombo}