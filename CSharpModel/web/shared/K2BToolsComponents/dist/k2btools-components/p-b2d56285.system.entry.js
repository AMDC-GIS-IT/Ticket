var __spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var i=Array(e),o=0,t=0;t<n;t++)for(var s=arguments[t],r=0,a=s.length;r<a;r++,o++)i[o]=s[r];return i};System.register(["./p-28f425d7.system.js","./p-5703b7e0.system.js"],(function(e){"use strict";var t,n,i,o;return{setters:[function(e){t=e.r;n=e.c;i=e.h},function(e){o=e.C}],execute:function(){var s=":host{display:block}.K2BTEnhancedComboHeader{border-bottom:1px solid #ccc}.K2BTEnhancedComboHeader:after{content:'â–¼';width:0px}.K2BTEnhancedComboContentsOpen{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;position:absolute;border:1px solid #ccc;background-color:#fff;z-index:1}.K2BTEnhancedComboSearchInput{width:100%}.K2BTEnhancedComboItems{max-height:300px;overflow:auto;scrollbar-width:thin;scrollbar-color:#d7d7d7 transparent}.K2BTEnhancedComboItems::-webkit-scrollbar{width:6px}.K2BTEnhancedComboItems::-webkit-scrollbar-thumb{background-color:#d7d7d7;border:1px solid transparent;cursor:pointer}.K2BTEnhancedComboContentsClosed{display:none}.K2BTEnhancedComboItem{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-align:center;align-items:center;padding:8px}.K2BTEnhancedComboItem:hover{background-color:#ddd;cursor:pointer}.K2BTEnhancedComboItem_TextContainer{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-positive:1;flex-grow:1}.K2BTEnhancedComboSubtitle{font-size:12px}.K2BTEnhancedComboCategoryName{padding-left:5px}.K2BTEnchancedComboCategoryContents .K2BTEnhancedComboItem{padding-left:10px}.K2BTEnhancedComboIcon{width:30px;height:30px;-o-object-fit:cover;object-fit:cover;margin-right:4px}.K2BTEnhancedComboIconInvisible{visibility:hidden}.K2BTEnhancedComboNoItemsFound{width:100%;text-align:center;margin-top:40px;margin-bottom:40px}.K2BTEnhancedComboTrailingText{-ms-flex-positive:0;flex-grow:0}";var r=e("k2bt_enhancedcombo",function(){function e(e){t(this,e);this.changeEvent=n(this,"change",7);this.searchChangedEvent=n(this,"searchChanged",7);this.newRecordClickedEvent=n(this,"newRecordClicked",7);this.value=null;this.includesearch=true;this.includeemptyitem=true;this.emptyitemtext="(none)";this.noresultsfoundtext="No results found";this.enableadditem=true;this.additemcaption="New record";this.searchfieldplaceholder="Search";this.searchvalue="";this.enabled=true;this.readonlyclass="";this.container=null;this.selectedElement=null;this.searchfield=null;this._keyboardSearchPrefix="";this._keyboardSearchLastKeystroke=null}e.prototype.processKeydown=function(e){var t=this;if(e.key=="Escape"){this.resetPrefixSearch();this.open=false;e.stopPropagation()}else if(e.key=="Enter"){this.resetPrefixSearch();this.open=!this.open;e.stopPropagation();return false}else if(e.key=="ArrowDown"){this.resetPrefixSearch();e.stopPropagation();e.preventDefault();var n=o.getAtomicValues_impl(this.getFilteredValues());if(n.length>0){var i=n.findIndex((function(e){return e.value.trim()==t.value.trim()}));if(i==-1){this.setValueWithoutClosing(n[0].value.trim())}else{i=((i+1)%n.length+n.length)%n.length;this.setValueWithoutClosing(n[i].value.trim())}}}else if(e.key=="ArrowUp"){this.resetPrefixSearch();e.stopPropagation();e.preventDefault();var n=o.getAtomicValues_impl(this.getFilteredValues());if(n.length>0){var i=n.findIndex((function(e){return e.value.trim()==t.value.trim()}));if(i==-1){this.setValueWithoutClosing(n[n.length-1].value.trim())}else{i=((i-1)%n.length+n.length)%n.length;this.setValueWithoutClosing(n[i].value.trim())}}}else{var s=e.key;if(s.length==1){if(document.activeElement!=this.searchfield){var r=Date.now();if(this._keyboardSearchLastKeystroke==null||r-this._keyboardSearchLastKeystroke>3e3){this._keyboardSearchPrefix=""}this._keyboardSearchPrefix=this._keyboardSearchPrefix+s;var n=o.getAtomicValues_impl(this.getFilteredValues());var a=n.find((function(e){return e.description.toLowerCase().indexOf(t._keyboardSearchPrefix.toLowerCase())==0}));if(a!=null){this.setValueWithoutClosing(a.value.trim())}this._keyboardSearchLastKeystroke=r}}}};e.prototype.onFocusIn=function(){this.resetPrefixSearch()};e.prototype.resetPrefixSearch=function(){this._keyboardSearchLastKeystroke=null};e.prototype.closeMenu=function(e){this.resetPrefixSearch();if(!this.container.contains(e.target))this.open=false};e.prototype.getHeaderContent=function(){var e=this;if(this.value==null)return this.emptyitemtext;else var t=this.getAtomicValues().filter((function(t){return t.value.trim()==e.value.trim()}));if(t.length>0)return t[0].description;else return this.emptyitemtext};e.prototype.toggleContentVisibilty=function(){this.resetPrefixSearch();this.open=!this.open};e.prototype.getRawValues=function(){var e;if(this.values==null){e=[]}else if(typeof this.values==="string"){if(this.values=="")e=[];else e=JSON.parse(this.values)}else{e=__spreadArrays(this.values)}if(this.includeemptyitem){e.unshift({value:"",description:this.emptyitemtext,imageUrl:"",detail:"",trailingText:"",items:[]})}return e};e.prototype.getFilteredValues=function(){var e=this.getRawValues();if(this.includesearch&&this.searchvalue!="")e=this.getFilteredValues_impl(e);return e};e.prototype.getFilteredValues_impl=function(e){var t=[];if(e!=undefined){for(var n=0,i=e;n<i.length;n++){var o=i[n];if(o.description.toLocaleLowerCase().indexOf(this.searchvalue.toLocaleLowerCase())!=-1||o.detail.toLocaleLowerCase().indexOf(this.searchvalue.toLocaleLowerCase())!=-1||o.trailingText.toLocaleLowerCase().indexOf(this.searchvalue.toLocaleLowerCase())!=-1){t=t.concat(o)}else{var s=this.getFilteredValues_impl(o.items);if(s.length>0){var r=Object.assign({},o);r.items=s;t=t.concat(r)}}}}return t};e.prototype.setValue=function(e){this.setValueWithoutClosing(e);this.open=false};e.prototype.setValueWithoutClosing=function(e){this.value=e;this.changeEvent.emit(e)};e.prototype.changeSearchValue=function(e){this.searchvalue=e;this.searchChangedEvent.emit({value:e})};e.prototype.onIncludeNewRecordClick=function(){this.open=false;this.newRecordClickedEvent.emit(null)};e.prototype.render=function(){var e=this;this.selectedElement=null;return i("div",null,i("p",{class:"form-control-static",style:this.enabled?{display:"none"}:{}},i("span",{class:this.readonlyclass},this.getHeaderContent())),i("div",{tabindex:"0",class:"K2BTEnhancedCombo",ref:function(t){return e.container=t},style:!this.enabled?{display:"none"}:{}},i("div",{class:"K2BTEnhancedComboHeader",onClick:function(){return e.toggleContentVisibilty()}},this.getHeaderContent()),i("div",{class:this.open?"K2BTEnhancedComboContentsOpen":"K2BTEnhancedComboContentsClosed"},this.includesearch?i("input",{type:"text",class:"K2BTEnhancedComboSearchInput",ref:function(t){return e.searchfield=t},onInput:function(t){return e.changeSearchValue(t.target.value)},placeholder:this.searchfieldplaceholder}):"",i("div",{class:"K2BTEnhancedComboItems"},this.getComboContent()),this.enableadditem?i("span",{class:"K2BTEnhancedComboNewAction",onClick:function(){return e.onIncludeNewRecordClick()}},this.additemcaption):"")))};e.prototype.getAtomicValues=function(){return o.getAtomicValues_impl(this.getRawValues())};e.prototype.getComboContent=function(){var e=this;var t=o.getAtomicValues_impl(this.getRawValues());var n=o.containsDetails(t);var s=o.containsIcons(t);var r=o.containsTrailingText(t);var a=!this.open?[]:this.getFilteredValues();if(a.length>0)return a.map((function(t){return e.getItemContent(t,n,s,r)}));else return i("div",{class:"K2BTEnhancedComboNoItemsFound"},this.noresultsfoundtext)};e.prototype.onImageError=function(e){e.target.classList.add("K2BTEnhancedComboIconInvisible")};e.prototype.getItemContent=function(e,t,n,o){var s=this;var r;if(((r=e.items)===null||r===void 0?void 0:r.length)>0){return i("div",{class:"K2BTEnhancedComboCategory"},i("span",{class:"K2BTEnhancedComboCategoryName"},e.description),i("div",{class:"K2BTEnchancedComboCategoryContents"},e.items.map((function(e){return s.getItemContent(e,t,n,o)}))))}else{return i("div",{class:this.value.trim()==e.value.trim()?"K2BTEnhancedComboItem K2BTEnhancedComboSelected":"K2BTEnhancedComboItem",ref:function(t){if(s.value.trim()==e.value.trim())s.selectedElement=t},onClick:function(){return s.setValue(e.value.trim())}},n?i("div",{class:"K2BTEnhancedComboIconContainer"},i("img",{class:"K2BTEnhancedComboIcon",src:e.imageUrl,onError:function(e){return s.onImageError(e)}})):"",i("div",{class:"K2BTEnhancedComboItem_TextColumn"},i("div",{class:"K2BTEnhancedComboItem_TextContainer"},i("span",{class:"K2BTEnhancedComboDescription"},this.getHighlightedText(e.description)),o?i("span",{class:"K2BTEnhancedComboTrailingText"},this.getHighlightedText(e.trailingText)):""),i("div",{class:"K2BTEnhancedComboItem_TextContainer"},t?i("span",{class:"K2BTEnhancedComboSubtitle"},this.getHighlightedText(e.detail)):"")))}};e.prototype.getHighlightedText=function(e){var t=e.toLowerCase().indexOf(this.searchvalue.toLowerCase());if(this.searchvalue==undefined||this.searchvalue==""||t==-1){return i("span",null,e)}else{return i("span",null,e.substring(0,t),i("span",{class:"K2BTEnhancedComboSearchHighlight"},e.substring(t,t+this.searchvalue.length)),this.getHighlightedText(e.substring(t+this.searchvalue.length)))}};e.prototype.componentDidRender=function(){if(this.selectedElement!=null){this.selectedElement.scrollIntoView({block:"nearest"})}};e.prototype.componentDidLoad=function(){var e=this;var t=this.getAtomicValues();if(!this.includeemptyitem&&t.filter((function(t){return t.value.trim()==e.value.trim()})).length==0){if(t.length>0){this.setValueWithoutClosing(t[0].value.trim())}}};return e}());r.style=s}}}));